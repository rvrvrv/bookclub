'use strict';function progress(a){'show'===a?$('.progress').removeClass('hidden'):$('.progress').addClass('hidden')}function restoreBtns(){if($('.req-btn').hasClass('confirm-rm-btn')){var a=$('.confirm-rm-btn');a.html('Remove Book'),a.attr('onclick','removeBook(this)'),a.removeClass('red white-text waves-light confirm-rm-btn').addClass('waves-red')}}function activateLinks(){$('#logoutLink').click(function(){FB.logout(function(){return checkLoginState(!0)})}),1<location.pathname.length&&$('.brand-logo').click(function(){return location.pathname='/'}),$('.dyn-link').each(function(){var a=$(this).data('link');a.includes('modal')?$(this).click(function(){return $(a).modal('open')}):!location.pathname.includes(a)&&$(this).click(function(){return location.href=a+'.html'})})}function generateLoggedInUI(a,b){if($('#userInfo').html('\n        <a class="dropdown-button" data-beloworigin="true" data-activates="userDropdown">\n        <li><img class="valign left-align" src="'+b+'"\n        alt="'+a.name+'" id="navImg"></li>\n        <li class="hide-on-small-only" id="navName">'+a.name.split(' ')[0]+'</li></a>'),$('#userDropdown').html('\n        <li><a class="waves-effect waves-green dyn-link" data-link="addbook">Add a Book</a></li>\n        <li><a class="modal-trigger waves-effect waves-green" data-target="profileModal">Edit Profile</a></li>\n        <li class="divider"></li>\n        <li><a class="waves-effect waves-green" id="logoutLink">Log Out</a></li>'),$('.dropdown-button').dropdown({inDuration:300,outDuration:225,constrainWidth:!1,hover:!0,gutter:0,belowOrigin:!1,alignment:'left',stopPropagation:!1}),$('.modals').append('\n    <div id="profileModal" class="modal bottom-sheet">\n      <div class="modal-content">\n        <h5>Edit Profile</h5>\n        <div class="row">\n          <form class="col s12">\n            <div class="row">\n              <div class="input-field col s12 m9 l6">\n                <i class="material-icons large prefix">account_circle</i>\n                <input id="profileName" value="'+a.name+'" alt="'+a.name+'" type="text" class="validate" pattern="[a-zA-Z][a-zA-Z0-9., ]{1,25}$">\n                <label class="active" for="profileName" data-error="Please enter a valid name.">Name</label>\n              </div>\n            </div>\n            <div class="row">\n              <div class="input-field col s12 m9 l6">\n                <i class="material-icons large prefix">my_location</i>\n                <input id="profileLocation" value="'+a.location+'" alt="'+a.location+'" type="text" class="validate"\n                  pattern="[a-zA-Z0-9., ]{2,25}$">\n                <label class="active" for="profileLocation" data-error="Please enter a valid location.">Location</label>\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n      <div class="modal-footer">\n        <a class="waves-effect waves-green btn-flat" id="editProfileBtn">Save</a>\n        <a class="waves-effect waves-red btn-flat" id="cancelChangesBtn">Cancel</a>\n      </div>\n    </div>'),$('#editProfileBtn').click(function(){return editProfile()}),$('#cancelChangesBtn').click(function(){return resetProfile()}),$('.modal').modal({complete:function complete(){return restoreBtns()}}),'/'===location.pathname){$('.fb-login-button').hide(),$('#welcome').html('<h5 class="white-text center">You\'re in the club!<br>\n            Feel free to <a class="dyn-link light-blue-text text-lighten-4" data-link="addbook">add a book</a>\n            or <span class="light-blue-text text-lighten-4 request-text">request a trade</span>.</h5>'),$('#bottomInfo').html('<h5 class="center">Select any book for more information.</h5>'),$('.request-text').click(function(){$('.carousel').addClass('shake'),setTimeout(function(){return $('.carousel').removeClass('shake')},1e3)}),$('.requests').html('\n      <ul class="collapsible" data-collapsible="accordion">\n      <li>\n        <div class="collapsible-header"><span class="badge incoming-count" data-badge-caption="">0</span>\n          <i class="material-icons">announcement</i>Incoming Requests</div>\n        <div class="collapsible-body">\n          <div class="collection" id="incomingList"></div>\n        </div>\n      </li>\n      <li>\n        <div class="collapsible-header"><span class="badge outgoing-count">0</span>\n          <i class="material-icons">swap_vertical_circle</i>Outgoing Requests</div>\n        <div class="collapsible-body">\n          <div class="collection" id="outgoingList"></div>\n        </div>\n      </li>\n      <li>\n        <div class="collapsible-header">\n          <i class="material-icons">view_module</i>Your Books</div>\n        <div class="collapsible-body">\n          <div class="collection" id="personalList"></div>\n        </div>\n      </li>\n    </ul>'),$('.collapsible').collapsible();for(var c=a.incomingRequests,d=0;d<c.length;d++){requestCount('incoming',1);var h=c[d];$('#incomingList').append('\n        <p class="collection-item" data-book="'+h.bookId+'" data-user="'+h.userId+'">\n          <a onclick="openModal($(this).parent())">'+h.title+'</a>\n          <a class="secondary-content tooltipped" data-tooltip="Reject trade" onclick="answerTrade($(this).parent())">\n            <i class="material-icons small red-text">not_interested</i>\n          </a>\n          <span class="secondary-content black-text">&nbsp;&nbsp;</span>\n          <a class="secondary-content tooltipped" data-tooltip="Accept trade" onclick="answerTrade($(this).parent(), true)">\n            <i class="material-icons small green-text">done</i>\n          </a>\n        </p>')}for(var e,f=a.outgoingRequests,g=0;g<f.length;g++)e=$('.req-btn[data-book="'+f[g].bookId+'"][data-owner="'+f[g].userId+'"]'),tradeReqUI(e,!0);$('.tooltipped').tooltip()}a.books.forEach(function(b){var c=$('.req-btn[data-book="'+b+'"][data-owner="'+a.id+'"]'),d=c.data('title');c.tooltip('remove'),c.removeClass('waves-green').addClass('waves-red'),c.attr('onclick','removeBook(this)'),c.attr('data-tooltip','Remove '+d+' from the collection'),c.html('Remove Book'),$('#personalList').append('\n      <a class="collection-item blue-text tooltipped" data-book="'+b+'" data-user="'+a.id+'" data-tooltip="View '+d+' and/or remove it from the collection" onclick="openModal($(this), true)">'+d+'</a>'),$('.tooltipped').tooltip()}),activateLinks()}function openModal(a,b){var c=b?a.data('user'):localStorage.getItem('rv-bookclub-id'),d=$('.modal-book[data-book="'+a.data('book')+'"][data-owner="'+c+'"]');d.modal('open')}function removeBook(a,b){if(!b)$(a).removeClass('waves-red').addClass('red white-text waves-light confirm-rm-btn'),$(a).html('Confirm Removal'),$(a).attr('onclick','removeBook(this, true)');else{progress('show');var c=$(a).data('book'),d='/api/book/'+c+'/'+localStorage.getItem('rv-bookclub-id');ajaxFunctions.ajaxRequest('DELETE',d,function(b){console.log(b),$('.carousel-item[data-book="'+c+'"]').remove(),$('.carousel').removeClass('initialized'),$('.carousel').carousel(),$('.modal[data-book="'+c+'"]').modal('close'),$('.modal[data-book="'+c+'"]').remove(),$(a).tooltip('remove'),Materialize.toast($(a).data('title')+' has been removed from the collection!',5e3),progress('hide')})}}